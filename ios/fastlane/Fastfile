profile_name = "match AppStore #{bundle_id}"

build_app(
  scheme: "Runner",
  workspace: "Runner.xcworkspace",
  export_method: "app-store",

  # Let gym handle provisioning via export_options (already correct)
  export_options: {
    signingStyle: "manual",
    teamID: team_id,
    provisioningProfiles: {
      bundle_id => profile_name
    }
  },

  # Keep these, but remove PROVISIONING_PROFILE_SPECIFIER from xcargs
  xcargs: %Q[
    DEVELOPMENT_TEAM=#{team_id}
    CODE_SIGN_STYLE=Manual
    PRODUCT_BUNDLE_IDENTIFIER=#{bundle_id}
    CODE_SIGN_IDENTITY="Apple Distribution"
  ]
)
