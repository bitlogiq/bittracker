profile_name = "match AppStore #{bundle_id}"

build_app(
  scheme: "Runner",
  workspace: "Runner.xcworkspace",
  export_method: "app-store",

  # Keep export_options â€” this is the correct place to bind the profile
  export_options: {
    signingStyle: "manual",
    teamID: team_id,
    provisioningProfiles: {
      bundle_id => profile_name
    }
  },

  # Clean xcargs: NO PROVISIONING_PROFILE_SPECIFIER here
  xcargs: %Q[
    DEVELOPMENT_TEAM=#{team_id}
    CODE_SIGN_STYLE=Manual
    PRODUCT_BUNDLE_IDENTIFIER=#{bundle_id}
    CODE_SIGN_IDENTITY="Apple Distribution"
  ]
)
